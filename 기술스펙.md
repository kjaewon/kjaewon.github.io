# 은퇴 카운트다운 및 준비 계획 웹앱 — 기술 스펙

## 1. 문서 정보

| 항목 | 내용 |
|------|------|
| 문서명 | 기술 스펙 (Technical Specification) |
| 프로젝트명 | 은퇴 카운트다운 및 준비 계획 웹앱 |
| 관련 문서 | PRD.md, 요구사항정의서.md |
| 초안 작성일 | 2025-02-18 |

---

## 2. 기술 스택

| 구분 | 기술 | 버전(대략) | 비고 |
|------|------|------------|------|
| 언어 | TypeScript | 5.9.x | strict 모드, ESNext 모듈 |
| 런타임 | 브라우저 (ES2022+) | — | Node는 빌드/개발용만 사용 |
| 프레임워크 | React | 19.x | 함수형 컴포넌트 + Hooks |
| 빌드/개발 서버 | Vite | 7.x | HMR, ESM 네이티브 |
| 스타일 | CSS | — | CSS Variables(테마), 반응형 |
| 데이터 저장 | LocalStorage | — | 1차: 클라이언트만. 확장 시 Supabase 연동 |
| 백엔드/DB | Supabase | — | Auth, PostgreSQL, RLS. 후속 버전·다중 사용자 시 사용 |
| 배포 | Vercel | — | 정적 SPA 배포, 자동 빌드·프리뷰 |
| 린트 | ESLint | 9.x | TypeScript + React Hooks 규칙 |

- **현재**: LocalStorage만 사용하는 정적 SPA. **확장 시**: Supabase Auth + DB로 다중 사용자·동기화 대응.
- **패키지 관리**: npm.

---

## 3. 프로젝트 구조

```
cursor-retire-age-project/
├── index.html              # 진입 HTML, root div + main.tsx 로드
├── package.json
├── vite.config.ts          # Vite 설정 (React 플러그인)
├── tsconfig.json           # TS 프로젝트 참조 (app/node)
├── tsconfig.app.json       # 앱 소스 TS 설정
├── tsconfig.node.json      # Vite 등 Node 스크립트 TS 설정
├── eslint.config.js
├── public/
│   └── vite.svg
├── src/
│   ├── main.tsx            # React 진입점, createRoot
│   ├── App.tsx             # 루트 컴포넌트, 상태·저장 연동
│   ├── App.css             # 앱·섹션·버튼 등 레이아웃 스타일
│   ├── index.css           # 전역 스타일, CSS 변수(테마)
│   ├── types.ts            # 공통 타입 정의
│   ├── storage.ts          # LocalStorage 읽기/쓰기
│   ├── components/
│   │   ├── RetirementDateInput.tsx  # 은퇴 예정일 date 입력
│   │   ├── CountdownSection.tsx     # D-XXX, 년/월/일 표시
│   │   ├── MilestonesSection.tsx   # 기념일 목록
│   │   └── PlanList.tsx            # 준비 계획 CRUD + 체크
│   └── utils/
│       ├── countdown.ts    # 남은 일수, 년/월/일, 메시지
│       └── milestones.ts  # 기념일 목록 계산, 날짜 포맷
├── dist/                   # vite build 산출물 (Vercel 배포용)
├── supabase/
│   ├── migrations/         # DB 스키마 마이그레이션
│   │   ├── 00001_initial_schema.sql
│   │   └── 00002_add_display_name_and_plan_details.sql
│   └── README.md           # 스키마 요약·적용 방법
├── .env.example            # 환경 변수 예시 (Vercel/Supabase 연동 시 참고)
├── PRD.md
├── 요구사항정의서.md
└── 기술스펙.md             # 본 문서
```

---

## 4. 모듈 설명

### 4.1 타입 (`src/types.ts`)

| 타입 | 용도 |
|------|------|
| `UserSettings` | `displayName`(선택), `retirementDate`, `birthDate`(선택) — 설정/저장용 |
| `RetirementPlan` | `id`, `title`, `description`(선택), `startDate`, `endDate`(선택), `completed`, `createdAt`, `completedAt`(선택) — 계획 한 건 |
| `MilestoneItem` | `label`, `date`, `daysFromRetirement`, `isPast` — 기념일 한 건 (계산 결과) |

- 날짜는 앱 내부에서는 `Date` 또는 ISO 문자열(YYYY-MM-DD 등)로 다룸.

### 4.2 저장소 (`src/storage.ts`)

- **키**: `retire-age-settings`, `retire-age-plans`
- **형식**: JSON. 설정은 `UserSettings`, 계획 목록은 `RetirementPlan[]`.
- **API**: `loadSettings` / `saveSettings`, `loadPlans` / `savePlans`
- 파싱 실패 시 설정은 `{ retirementDate: null }`, 계획은 `[]` 반환.

### 4.3 유틸

- **countdown.ts**: `getRemainingDays`, `getRemainingYMD`, `getCountdownMessage` — 오늘과 목표일 기준 남은 기간·메시지 판별.
- **milestones.ts**: `getMilestones(retirementDate)` — 100/200/300일 전, 1/2/3/5/10년 전 날짜 리스트 반환. `formatDate` — 한국어 날짜 문자열.

### 4.4 컴포넌트

| 컴포넌트 | 역할 |
|----------|------|
| `RetirementDateInput` | `<input type="date">`로 은퇴 예정일 입력, 상위에서 제어(controlled). |
| `CountdownSection` | 설정된 날짜가 있으면 D-XXX·년/월/일 또는 과거/오늘 메시지 표시. |
| `MilestonesSection` | 기념일 리스트 + 날짜 + (미래만) D-X, 지난 항목은 "지남" 표시. |
| `PlanList` | 계획 추가(제목·세부 내용·시작일·종료 예정일), 목록 표시, 완료 체크(실제 완료일 기록), 수정·삭제. 상태는 상위에서 관리하고 `onPlansChange`로 반영. |

- `App.tsx`: `useState`로 설정·계획 보관, `useEffect`로 `storage`에 동기화. 은퇴일을 `Date | null`로 파싱해 카운트다운·기념일에 전달.

---

## 5. 데이터 흐름

1. **초기 로딩**: `App` 마운트 시 `loadSettings()`, `loadPlans()`로 상태 초기화.
2. **은퇴 예정일 변경**: 사용자 입력 → `setSettings` → `useEffect`로 `saveSettings(settings)`.
3. **계획 변경**: 추가/수정/삭제/체크 → `setPlans` → `useEffect`로 `savePlans(plans)`.
4. **화면 표시**: `retirementDate`(Date | null)와 `plans`를 자식 컴포넌트에 props로 전달. 기념일·카운트다운은 `retirementDate`만 사용해 클라이언트에서 계산.

---

## 6. 빌드 및 실행

| 명령 | 설명 |
|------|------|
| `npm install` | 의존성 설치 |
| `npm run dev` | Vite 개발 서버 (기본 http://localhost:5173) |
| `npm run build` | `tsc -b` 후 `vite build` → `dist/` 생성 |
| `npm run preview` | `dist/` 기준 로컬 프리뷰 |
| `npm run lint` | ESLint 실행 |

- **배포**: 아래 "11. Vercel 배포" 참고.

---

## 11. Vercel 배포

- **플랫폼**: [Vercel](https://vercel.com). GitHub/GitLab/Bitbucket 연동 시 푸시마다 자동 빌드·배포.
- **빌드 설정**
  - **Build Command**: `npm run build` (또는 기본값 유지)
  - **Output Directory**: `dist`
  - **Install Command**: `npm install`
  - **Framework Preset**: Vite 선택 시 자동 반영됨.
- **환경 변수**: 현재 앱은 LocalStorage만 사용하므로 **필수 env 없음**. 추후 Supabase 연동 시 Vercel 프로젝트 **Settings → Environment Variables**에 다음 추가 가능.
  - `VITE_SUPABASE_URL`: Supabase 프로젝트 URL
  - `VITE_SUPABASE_ANON_KEY`: Supabase anon(public) key  
  (Vite 클라이언트 노출용이므로 `VITE_` 접두사 필수.)
- **참고**: `.env.example`에 예시 항목 정리. 로컬에서는 `.env.local` 등으로 복사 후 사용.

---

## 12. Supabase (백엔드/DB)

- **역할**: 다중 사용자·회원가입·로그인 및 데이터 영속화가 필요할 때 사용. 현재 앱은 LocalStorage 단독 동작 가능.
- **구성**
  - **Auth**: `auth.users` — 가입/로그인. 로그인한 사용자 `id`를 `user_id`로 사용.
  - **DB**: PostgreSQL. 테이블은 RLS(Row Level Security)로 사용자별 접근 제한.
- **테이블**
  - **user_settings** (사용자당 1행): `user_id`, `display_name`, `retirement_date`, `birth_date`, `created_at`, `updated_at`. 가입 시 트리거로 1행 자동 생성.
  - **retirement_plans**: `user_id`, `title`, `description`, `start_date`, `end_date`, `completed`, `completed_at`, `created_at`, `updated_at`. 인덱스: `user_id`, `created_at` desc.
- **마이그레이션**
  - `supabase/migrations/00001_initial_schema.sql`: 테이블 생성, RLS 정책, `updated_at` 트리거, 가입 시 `user_settings` 생성 트리거.
  - `00002_add_display_name_and_plan_details.sql`: 기존 DB에 `display_name`, `description`, `start_date`, `end_date` 컬럼 추가용 (이미 00001 적용한 경우만 실행).
- **적용 방법**: Supabase 대시보드 → SQL Editor에서 마이그레이션 내용 실행. 또는 Supabase CLI로 `supabase link` 후 `supabase db push`.
- **상세**: `supabase/README.md` 참고.

---

## 13. 개발 환경 요구사항

- **Node.js**: 18.x 이상 권장 (LTS).
- **npm**: 9.x 이상.
- **편집기**: TypeScript·JSX 지원 권장 (예: VS Code, Cursor).

---

## 14. 브라우저 지원

- ES2022·ES 모듈을 지원하는 최신 브라우저.
- 요구사항정의서 기준: Chrome, Firefox, Safari, Edge 최신 버전.
- `index.html`의 viewport 메타로 모바일 반응형 대응.

---

## 15. 코딩 규칙 (TypeScript/React)

- **strict**: true. 미사용 지역 변수/매개변수 금지.
- **모듈**: ESNext, `verbatimModuleSyntax` 사용. 타입만 쓸 때는 `import type` 사용.
- **React**: 함수형 컴포넌트, Hooks만 사용. 클래스 컴포넌트 없음.
- **스타일**: 전역은 `index.css`, 컴포넌트/페이지 레이아웃은 `App.css`. BEM 유사 클래스명 또는 단순 클래스명 사용.

---

## 16. 문서 이력

| 버전 | 일자 | 변경 내용 |
|------|------|-----------|
| 0.1 | 2025-02-18 | 초안 작성 |
| 0.2 | 2025-02-18 | Supabase 스키마·마이그레이션, Vercel 배포 절차 및 환경 변수 추가 |
